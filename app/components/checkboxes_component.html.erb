<div class="space-y-4">
  <%= @form.hidden_field @method, value: "" %>
  <% content = capture {
    @form.collection_checkboxes(@method, @collection, @item_value_method, @item_label_method) do |checkbox_item|
      content_tag :div, class: "checkbox_item" do
        concat checkbox_item.checkbox("x-data" => {}, "x-model" => "$store.#{@method}")
        concat checkbox_item.label
      end
    end
  } %>
  <% concat content %>
  <%= render(FormErrorsComponent.new(form: @form, method: @method)) %>
</div>

<script>
  function set_store_to_current_value() {
    Alpine.store("<%= @method %>", <%= current_value&.to_s&.html_safe || [] %>);
  }

  if (window.Alpine === undefined) {
    document.addEventListener('alpine:init', set_store_to_current_value);
  } else {
    set_store_to_current_value();
  }
</script>
